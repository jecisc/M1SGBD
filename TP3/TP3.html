<!--?xml version="1.0" encoding="iso-8859-1"?-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>

  <meta content="text/html; charset=windows-1252" http-equiv="content-type">
  <link href="TP3_fichiers/cours.css" rel="stylesheet" type="text/css">
  <title>cours BDA</title>


</head>

<body>
<h1>TP Oracle et SQL/XML</h1>

<h2>Partie 1 : Génération de XML à partir de tables relationnelles</h2>

<p>
Créez les tables <code>PAYS</code> et <code>VILLE</code> à partir de ce <a href="http://www.fil.univ-lille1.fr/%7Ecaronc/SGBD/paysVilles.sql">script SQL</a>.
</p>


<p>Dans cette première partie, nous allons utiliser les fonctions de génération d'XML :</p>

<ul>
<li>XMLElement</li>
<li>XMLAttributes</li>
<li>XMLForest</li>
<li>XMLAgg</li>
<li>...</li>
</ul>

<p>Des exemples d'utilisation de ces fonctions sont données en cours. 
La documentation Oracle concernant ces fonctions est <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28369/xdb13gen.htm#i1029583">ici</a></p>

<p>Dans les questions qui suivent, il est indiqué le résultat que l'on veut obtenir, <b>mais ce résultat ne tient pas compte
de la casse des caractères en ce qui concerne les noms des balises.</b> Il ne faut pas non plus tenir compte de l'ordre
des lignes, ou des éléments d'une collection.</p>

<h4>Question 1</h4>

<p>Ecrire une requête qui donne la liste des noms des pays, chacun dans une balise XML</p>

<pre>resultat :
&lt;pays&gt;france&lt;/pays&gt;
&lt;pays&gt;cameroun&lt;/pays&gt;
&lt;pays&gt;maroc&lt;/pays&gt; 
...
13 ligne(s) sélectionnée(s).
</pre>

<h4>Question 2</h4>

<p>On veut chaque pays avec 3 sous-elements ref_pays, nom et nb_habitants</p>

<pre>résultat :

&lt;pays&gt;&lt;REF_PAYS&gt;1&lt;/REF_PAYS&gt;&lt;NOM&gt;france&lt;/NOM&gt;&lt;NB_HABITANTS&gt;61000000&lt;/NB_HABITANTS&gt;&lt;/pays&gt;
&lt;pays&gt;&lt;REF_PAYS&gt;2&lt;/REF_PAYS&gt;&lt;NOM&gt;cameroun&lt;/NOM&gt;&lt;NB_HABITANTS&gt;15700000&lt;/NB_HABITANTS&gt;&lt;/pays&gt;
&lt;pays&gt;&lt;REF_PAYS&gt;3&lt;/REF_PAYS&gt;&lt;NOM&gt;maroc&lt;/NOM&gt;&lt;NB_HABITANTS&gt;29600000&lt;/NB_HABITANTS&gt;&lt;/pays&gt; 
...
13 ligne(s) sélectionnée(s).
</pre>

<h4>Question 3</h4>

<p>On veut maintenant que la valeur de <code>ref_pays</code> soit plutôt un attribut qu'un sous-élément</p>

<pre>résultat :
&lt;pays ID="1"&gt;&lt;nom&gt;france&lt;/nom&gt;&lt;nb_habitants&gt;61000000&lt;/nb_habitants&gt;&lt;/pays&gt;
&lt;pays ID="2"&gt;&lt;nom&gt;cameroun&lt;/nom&gt;&lt;nb_habitants&gt;15700000&lt;/nb_habitants&gt;&lt;/pays&gt;
&lt;pays ID="3"&gt;&lt;nom&gt;maroc&lt;/nom&gt;&lt;nb_habitants&gt;29600000&lt;/nb_habitants&gt;&lt;/pays&gt; 
...
13 ligne(s) sélectionnée(s).
</pre>

<h4>Question 4</h4>

<p>Regrouper tous les pays dans 1 seul document</p>

<pre>résultat (1 seule ligne) :
&lt;les_pays&gt;
   &lt;pays ID="1"&gt;&lt;nom&gt;france&lt;/nom&gt;&lt;nb_habitants&gt;61000000&lt;/nb_habitants&gt;&lt;/pays&gt;
   &lt;pays ID="2"&gt;&lt;nom&gt;cameroun&lt;/nom&gt;&lt;nb_habitants&gt;15700000&lt;/nb_habitants&gt;&lt;/pays&gt;
   &lt;pays ID="3"&gt;&lt;nom&gt;maroc&lt;/nom&gt;&lt;nb_habitants&gt;29600000&lt;/nb_habitants&gt;
   ...
 &lt;/les_pays&gt; 
</pre>

<h4>Question 5</h4>

<p>Ecrire une requête qui fournit les villes avec leur pays, à l'aide d'une jointure</p>

<pre>&lt;ville&gt;&lt;nom&gt;guadalajara&lt;/nom&gt;&lt;pays&gt;mexique&lt;/pays&gt;&lt;/ville&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
&lt;ville&gt;&lt;nom&gt;bordeaux&lt;/nom&gt;&lt;pays&gt;france&lt;/pays&gt;&lt;/ville&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
&lt;ville&gt;&lt;nom&gt;toronto&lt;/nom&gt;&lt;pays&gt;canada&lt;/pays&gt;&lt;/ville&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
...
60 ligne(s) selectionnee(s)
</pre>

<h4>Question 6</h4>
<p>Ecrire une requête qui donne tous les pays avec leurs villes comme sous-éléments. Essayer de 2 manières : 
avec une jointure ou avec une sous-requête.</p>

<pre>&lt;pays ID="1" NOM="france"&gt;&lt;ville&gt;lille&lt;/ville&gt;&lt;ville&gt;paris&lt;/ville&gt;&lt;ville&gt;lyon&lt;/ville&gt;&lt;ville&gt;bordeaux&lt;/ville&gt;&lt;ville&gt;marseille&lt;/ville&gt;&lt;/pays&gt;
&lt;pays ID="2" NOM="cameroun"&gt;&lt;ville&gt;douala&lt;/ville&gt;&lt;ville&gt;garoua&lt;/ville&gt;&lt;ville&gt;yaoundé&lt;/ville&gt;&lt;ville&gt;bafoussam&lt;/ville&gt;&lt;/pays&gt;
&lt;pays ID="3" NOM="maroc"&gt;&lt;ville&gt;casablanca&lt;/ville&gt;&lt;ville&gt;rabat&lt;/ville&gt;&lt;ville&gt;fès&lt;/ville&gt;&lt;ville&gt;marrakech&lt;/ville&gt;&lt;/pays&gt; 
...
13 ligne(s) sélectionnée(s).
</pre>

<h4>Question 7</h4>
<p>Ecrire une requête qui donne tous les pays avec pour chacun en attribut leur nombre de villes dans la base.
</p>

<pre>résultat :

&lt;pays NB_VILLES="11"&gt;états unis&lt;/pays&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
&lt;pays NB_VILLES="5"&gt;france&lt;/pays&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
&lt;pays NB_VILLES="4"&gt;canada&lt;/pays&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
&lt;pays NB_VILLES="3"&gt;turquie&lt;/pays&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
&lt;pays NB_VILLES="5"&gt;royaume uni&lt;/pays&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
&lt;pays NB_VILLES="5"&gt;mexique&lt;/pays&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
&lt;pays NB_VILLES="4"&gt;cameroun&lt;/pays&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
&lt;pays NB_VILLES="5"&gt;japon&lt;/pays&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
&lt;pays NB_VILLES="5"&gt;allemagne&lt;/pays&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
&lt;pays NB_VILLES="3"&gt;chine&lt;/pays&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
&lt;pays NB_VILLES="4"&gt;maroc&lt;/pays&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
&lt;pays NB_VILLES="2"&gt;senegal&lt;/pays&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
&lt;pays NB_VILLES="4"&gt;espagne&lt;/pays&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               

 13 lignes sélectionnées 
</pre>

<h4>Question 8</h4>

<p>On veut maintenant toutes les informations sur les pays, sous la forme d'1 arbre XML de racine <code>les_pays</code>, et
pour chaque pays les villes avec le nombre d'habitants, classées par ordre alphabétiques.</p>

<pre>résultat :
&lt;les_pays&gt;
  &lt;pays ID="1"&gt;
    &lt;nom&gt;france&lt;/nom&gt;
    &lt;villes&gt;
      &lt;ville&gt;&lt;NOM&gt;bordeaux&lt;/NOM&gt;&lt;NB_HABITANTS&gt;685000&lt;/NB_HABITANTS&gt;&lt;/ville&gt;
      &lt;ville&gt;&lt;NOM&gt;lille&lt;/NOM&gt;&lt;NB_HABITANTS&gt;950000&lt;/NB_HABITANTS&gt;&lt;/ville&gt;
      &lt;ville&gt;&lt;NOM&gt;lyon&lt;/NOM&gt;&lt;NB_HABITANTS&gt;1200000&lt;/NB_HABITANTS&gt;&lt;/ville&gt;
      &lt;ville&gt;&lt;NOM&gt;marseille&lt;/NOM&gt;&lt;NB_HABITANTS&gt;1087000&lt;/N B_HABITANTS&gt;&lt;/ville&gt;
      &lt;ville&gt;&lt;NOM&gt;paris&lt;/NOM&gt;&lt;NB_HABITANTS&gt;9000000&lt;/NB_HABITANTS&gt;&lt;/ville&gt;
    &lt;/villes&gt;
  &lt;/pays&gt;
  &lt;pays ID="2"&gt;
    &lt;nom&gt;cameroun&lt;/nom&gt;
    &lt;villes&gt;
      &lt;ville&gt; &lt;NOM&gt;bafoussam&lt;/NOM&gt;&lt;NB_HABITANTS&gt;347500&lt;/NB_HABITANTS&gt;&lt;/ville&gt;
      &lt;ville&gt;&lt;NOM&gt;douala&lt;/NOM&gt;&lt;NB_HABITANTS&gt;1500000&lt;/NB_HABITANTS&gt;&lt;/ville&gt;
      &lt;ville&gt;&lt;NOM&gt;garoua&lt; /NOM&gt;&lt;NB_HABITANTS&gt;357000&lt;/NB_HABITANTS&gt;&lt;/ville&gt;
      &lt;ville&gt;&lt;NOM&gt;yaoundé&lt;/NOM&gt;&lt;NB_HABITANTS&gt;1000000&lt;/NB_HABITANTS&gt;&lt;/ville&gt;
    &lt;/villes&gt;
  &lt;/pays&gt;
  &lt;pays ID="3"&gt;
    &lt;nom &gt;maroc&lt;/nom&gt;
    &lt;villes&gt;
      &lt;ville&gt;&lt;NOM&gt;casablanca&lt;/NOM&gt;&lt;NB_HABITANTS&gt;3200000&lt;/NB_HABITANTS&gt;&lt;/ville&gt;
      &lt;ville&gt;&lt;NOM&gt;fès&lt;/NOM&gt;&lt;NB_HABITANTS&gt;735000&lt;/NB_HABITANTS&gt;&lt;/ville&gt;
      &lt;ville&gt;&lt;NOM&gt;marrakech&lt;/NOM&gt;&lt;NB_HABITANTS&gt;635000&lt;/NB_HABITANTS&gt;&lt;/ville&gt;
      &lt;ville&gt;&lt;NOM&gt;rabat&lt;/NOM&gt;&lt;NB_HABITANTS&gt;1300000&lt;/NB_HABITANTS&gt;&lt;/ville&gt;
    &lt;/villes&gt;
  &lt;/pays&gt;
  ...
&lt;/les_pays&gt; 
</pre>






</body></html>